{% extends "base.j2" %}

{% block title %}QueryWeaver â€” Natural language to SQL{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/landing.css">
{% endblock %}

{% block content %}
<!-- Top header with logo -->
<header class="site-header" role="banner">
  <div class="site-header-inner">
    <img src="/static/icons/queryweaver.webp" alt="QueryWeaver" />
  </div>
</header>

<div class="landing-container">

  <!-- Left hero -->
  <section class="hero-left">
    <h1 class="hero-title">Transform Plain<br />English into Powerful<br />SQL.</h1>
    <p class="hero-sub">The intelligent AI solution that connects your business questions to data across multiple
      databases. Ask a question in plain English and get runnable SQL and visual results.</p>

    <div class="hero-ctas">
      <a href="{{ url_for('auth.chat') }}" class="btn-pill">Sign Up for Free</a>
      <a href="{{ url_for('auth.chat') }}" class="btn-ghost">Sign In</a>
    </div>
  </section>

  <!-- Right demo card -->
  <aside class="demo-card">
    <div class="demo-inner">
      <div class="demo-label">Your Business Question:</div>
      <div class="demo-question">Which customers from Germany who bought 'Chai' also have an open support ticket in
        Salesforce?</div>

      <div class="demo-sql-header">
        <div class="demo-label">Generated SQL:</div>
        <div class="demo-success" style="display:none;">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="8" cy="8" r="8" fill="#10B981" />
            <path d="M5.5 8L7 9.5L10.5 6" stroke="white" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          <span>Success</span>
        </div>
      </div>
      <pre class="demo-sql"></pre>

      <div class="demo-cta">
        <button id="demo-next" class="btn-full" type="button">Try another question</button>
      </div>
    </div>
    <script>
      (function () {
        const examples = [
          {
            q: "Which customers from Germany who bought 'Chai' also have an open support ticket in Salesforce?",
            sql: `SELECT c.companyName\nFROM customers c\nJOIN orders o ON c.customerID = o.customerID\nJOIN order_details od ON o.orderID = od.orderID\nJOIN products p ON od.productID = p.productID\nJOIN salesforce_tickets st ON c.customerID = st.customerID\nWHERE c.country = 'Germany'\n  AND p.productName = 'Chai'\n  AND st.status = 'Open';`
          },
          {
            q: "Show me the top 5 customers by order count in London.",
            sql: `SELECT c.companyName, COUNT(o.orderID) AS order_count\nFROM customers c\nJOIN orders o ON c.customerID = o.customerID\nWHERE c.city = 'London'\nGROUP BY c.companyName\nORDER BY order_count DESC\nLIMIT 5;`
          },
          {
            q: "What is the quarterly revenue trend for the 'Beverages' category over the last two years?",
            sql: `SELECT strftime('%Y-Q%q', o.orderDate) AS quarter,\n  SUM(od.unitPrice * od.quantity) AS total_revenue\nFROM orders o\nJOIN order_details od ON o.orderID = od.orderID\nJOIN products p ON od.productID = p.productID\nJOIN categories cat ON p.categoryID = cat.categoryID\nWHERE cat.categoryName = 'Beverages'\n  AND o.orderDate >= date('now', '-2 years')\nGROUP BY quarter\nORDER BY quarter;`
          }
        ];

        let idx = 0;
        const qEl = document.querySelector('.demo-question');
        const sEl = document.querySelector('.demo-sql');
        const successEl = document.querySelector('.demo-success');
        const btn = document.getElementById('demo-next');

        let typingTimer = null;
        const typingSpeed = 15; // ms per character

        function escapeHtml(s) {
          return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        // very small client-side SQL highlighter (runs after typing completes)
        function highlightSQL(sql) {
          if (!sql) return '';
          // escape first
          let out = escapeHtml(sql);
          // strings (single quotes)
          out = out.replace(/('[^']*')/g, '<span class="sql-string">$1</span>');
          // keywords
          out = out.replace(/\b(SELECT|FROM|JOIN|ON|WHERE|AND|OR|GROUP|BY|ORDER|LIMIT|AS|IN|IS|NULL|INNER|LEFT|RIGHT|OUTER)\b/gi,
            function (m) { return '<span class="sql-keyword">' + m + '</span>'; });
          // aggregate/functions
          out = out.replace(/\b(COUNT|SUM|AVG|MIN|MAX)\b/gi, function (m) { return '<span class="sql-func">' + m + '</span>'; });
          // numbers
          out = out.replace(/\b(\d+\.?\d*)\b/g, '<span class="sql-number">$1</span>');
          return out;
        }

        function renderFull(i) {
          const ex = examples[i % examples.length];
          if (qEl) qEl.textContent = ex.q;
          if (sEl) {
            sEl.classList.remove('typing');
            // show highlighted SQL after typing completes
            sEl.innerHTML = highlightSQL(ex.sql);
          }
          if (successEl) successEl.style.display = 'flex';
        }

        function typeSql(text) {
          if (!sEl) return;
          // hide success while typing
          if (successEl) successEl.style.display = 'none';
          // stop any previous typing
          if (typingTimer) {
            clearInterval(typingTimer);
            typingTimer = null;
          }
          sEl.classList.add('typing');
          sEl.textContent = '';
          let pos = 0;
          typingTimer = setInterval(() => {
            pos += 1;
            // progressively render highlighted HTML for the substring so colors appear while typing
            if (sEl) sEl.innerHTML = highlightSQL(text.slice(0, pos));
            if (pos >= text.length) {
              clearInterval(typingTimer);
              typingTimer = null;
              sEl.classList.remove('typing');
              if (sEl) sEl.innerHTML = highlightSQL(text);
              // show success when typing completes
              if (successEl) successEl.style.display = 'flex';
            }
          }, typingSpeed);
        }

        if (btn) {
          btn.addEventListener('click', function () {
            idx = (idx + 1) % examples.length;
            const ex = examples[idx];
            if (qEl) qEl.textContent = ex.q;
            // animate SQL typing
            typeSql(ex.sql);
          });
        }

        // initial render: use typing animation for first example too
        const firstExample = examples[0];
        if (qEl) qEl.textContent = firstExample.q;
        typeSql(firstExample.sql);
      })();
    </script>
</div>

<!-- Feature boxes -->
<section class="features-row" aria-label="Key features">
  <div class="feature-card">
    <div class="feature-icon" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="h-6 w-6 text-primary-blue transition-transform group-hover:rotate-6">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    </div>
    <h3 class="feature-title">Knowledge Graph Power</h3>
    <p class="feature-desc">Goes beyond simple column matching to understand complex business logic and relationships in
      your data.</p>
  </div>

  <div class="feature-card">
    <div class="feature-icon" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="h-6 w-6 text-primary-blue transition-transform group-hover:scale-110">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
      </svg>
    </div>
    <h3 class="feature-title">Multi-Database Joins</h3>
    <p class="feature-desc">Ask a single question and get answers from disparate sources like PostgreSQL and Salesforce
      in one go.</p>
  </div>

  <div class="feature-card">
    <div class="feature-icon" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="h-6 w-6 text-primary-blue transition-transform group-hover:animate-pulse">
        <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 9 7c0 1.3.5 2.6 1.5 3.5.7.8 1.3 1.5 1.5 2.5">
        </path>
        <path d="M9 18h6"></path>
        <path d="M10 22h4"></path>
      </svg>
    </div>
    <h3 class="feature-title">Proactive Guidance</h3>
    <p class="feature-desc">Get intelligent suggestions to clarify ambiguity and optimize your queries before you even
      run them.</p>
  </div>
</section>

{% endblock %}
